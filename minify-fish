import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";import{OrbitControls}from"three/addons/controls/OrbitControls.js";const container=document.getElementById("hero-container"),containerRect=container.getBoundingClientRect(),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(35,containerRect.width/containerRect.height,1,500);camera.position.set(0,0,5);const renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});renderer.setSize(containerRect.width,containerRect.height),container.appendChild(renderer.domElement),scene.add(new THREE.AmbientLight(12516605,1));const dirLight=new THREE.DirectionalLight(16645883,2.25);dirLight.position.set(10,10,10),scene.add(dirLight);const mouse=new THREE.Vector2,raycaster=new THREE.Raycaster;window.addEventListener("mousemove",(e=>{mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1}));const targetPlane=new THREE.Plane(new THREE.Vector3(0,0,1),0),targetPoint=new THREE.Vector3,loader=new GLTFLoader;let fish,headBone,tailBone,mixer,vertebraeBones=[];loader.load("https://www.jackballdev.com/threeJS/assets/Fish-Bone-Computer-refinedAnimation.glb",(e=>{fish=e.scene,fish.traverse((e=>{e.isMesh&&e.material?.name.toLowerCase().includes("screen")&&(e.material=new THREE.MeshPhysicalMaterial({color:12516605,transparent:!0,opacity:.2,roughness:.15,metalness:0,transmission:1,ior:5,thickness:.3,envMapIntensity:1})),e.isBone&&"Head"===e.name&&(headBone=e),!e.isBone||"Bone"!==e.name&&"Bone002"!==e.name&&"Bone003"!==e.name&&"Bone004"!==e.name&&"Bone005"!==e.name&&"Bone008"!==e.name&&"Bone009"!==e.name||vertebraeBones.push(e),e.isBone&&"Tail"===e.name&&(tailBone=e)}));const n=(new THREE.Box3).setFromObject(fish).getCenter(new THREE.Vector3);if(fish.position.sub(n),scene.add(fish),fish.rotation.y=-1.5,e.animations&&e.animations.length){mixer=new THREE.AnimationMixer(fish);const n=mixer.clipAction(e.animations[0]);n.setLoop(THREE.LoopRepeat),n.setEffectiveWeight(1),n.setEffectiveTimeScale(1),n.clampWhenFinished=!0,n.enabled=!0,n.play(),console.log(`Animation loaded: ${e.animations[0].name}, duration: ${e.animations[0].duration}s`)}}),void 0,(e=>console.error("Error loading model:",e))),window.addEventListener("resize",(()=>{const e=container.getBoundingClientRect();camera.aspect=e.width/e.height,camera.updateProjectionMatrix(),renderer.setSize(e.width,e.height)}));const clock=new THREE.Clock,smoothedTarget=new THREE.Vector3;function animate(){requestAnimationFrame(animate);const e=clock.getDelta();if(mixer){const n=Math.min(e,1/30);mixer.update(n)}if(raycaster.setFromCamera(mouse,camera),raycaster.ray.intersectPlane(targetPlane,targetPoint),smoothedTarget.lerp(targetPoint,.2),headBone){const e=new THREE.Vector3;headBone.getWorldPosition(e);const n=-(new THREE.Vector3).subVectors(smoothedTarget,e).normalize().y,t=THREE.MathUtils.degToRad(20),o=THREE.MathUtils.clamp(n*t,-t,t);(new THREE.Quaternion).setFromEuler(new THREE.Euler(o,0,0));headBone.rotation.z=o+1.5,headBone.rotation.x=0}renderer.render(scene,camera)}animate();
